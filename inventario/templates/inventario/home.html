{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Produtos em Estoque</h2>
    <div>
    <a href="{% url 'inventario:criar_produto' %}?next={% url 'inventario:home' %}" class="btn btn-primary">Novo Produto</a>
        <a href="{% url 'inventario:movimentacao_estoque' %}" class="btn btn-success">Nova Movimentação</a>
    </div>
</div>

<div class="mb-3">
    <form method="get" class="row align-items-center">
        <div class="col-auto">
            <label for="itens_por_pagina" class="form-label">Itens por página:</label>
        </div>
        <div class="col-auto">
            <select name="itens_por_pagina" id="itens_por_pagina" class="form-select" onchange="this.form.submit()">
                <option value="10" {% if itens_por_pagina == '10' %}selected{% endif %}>10</option>
                <option value="25" {% if itens_por_pagina == '25' %}selected{% endif %}>25</option>
                <option value="50" {% if itens_por_pagina == '50' %}selected{% endif %}>50</option>
                <option value="100" {% if itens_por_pagina == '100' %}selected{% endif %}>100</option>
            </select>
        </div>
    </form>
</div>

<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Nome</th>
                <th>SKU</th>
                <th>Categoria</th>
                <th>Quantidade</th>
                <th>Status</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for produto in produtos %}
            <tr>
                <td>{{ produto.nome }}</td>
                <td>{{ produto.sku|default:"-" }}</td>
                <td>{{ produto.categoria|default:"-" }}</td>
                <td>{{ produto.quantidade_atual }}</td>
                <td>
                    {% if produto.status == 'ideal' %}
                        <span class="badge bg-success">Ideal</span>
                    {% elif produto.status == 'normal' %}
                        <span class="badge bg-warning">Normal</span>
                    {% elif produto.status == 'baixo' %}
                        <span class="badge bg-danger">Baixo</span>
                    {% else %}
                        <span class="badge bg-secondary">Limite não definido</span>
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group">
                        <a href="{% url 'inventario:editar_produto' produto.pk %}?next={% url 'inventario:home' %}" class="btn btn-sm btn-outline-primary">Editar</a>
                        <a href="{% url 'inventario:limite_produto' produto.pk %}?next={% url 'inventario:home' %}" class="btn btn-sm btn-outline-info">Limites</a>
                        <a href="{% url 'inventario:deletar_produto' produto.pk %}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Tem certeza que deseja excluir este produto?')">Excluir</a>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">Nenhum produto cadastrado.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<nav>
    <ul class="pagination">
        {% if produtos.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page=1&items_per_page={{ items_per_page }}">Primeira</a>
        </li>
        <li class="page-item">
            <a class="page-link" href="?page={{ produtos.previous_page_number }}&items_per_page={{ items_per_page }}">Anterior</a>
        </li>
        {% endif %}

        <li class="page-item active">
            <span class="page-link">
                Página {{ produtos.number }} de {{ produtos.paginator.num_pages }}
            </span>
        </li>

        {% if produtos.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ produtos.next_page_number }}&items_per_page={{ items_per_page }}">Próxima</a>
        </li>
        <li class="page-item">
            <a class="page-link" href="?page={{ produtos.paginator.num_pages }}&items_per_page={{ items_per_page }}">Última</a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endblock %}